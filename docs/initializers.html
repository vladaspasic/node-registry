<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Initializers</title>
  <meta name="description" content="Library for building scalable node.js applications with ease">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css" />
  <link rel="stylesheet" href="/node-registry/css/main.css">

  <link rel="canonical" href="http://vladaspasic.github.io//node-registry/docs/initializers.html">
  <link rel="alternate" type="application/rss+xml" title="Node registry" href="/node-registry/feed.xml">

  <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Initializers - Node registry</title>
<meta property="og:title" content="Initializers" />
<meta name="description" content="Library for building scalable node.js applications with ease" />
<meta property="og:description" content="Library for building scalable node.js applications with ease" />
<link rel="canonical" href="http://vladaspasic.github.io//node-registry/docs/initializers.html" />
<meta property="og:url" content="http://vladaspasic.github.io//node-registry/docs/initializers.html" />
<meta property="og:site_name" content="Node registry" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@VladaSpasic" />
<meta name="twitter:creator" content="@Vladimir Spasic" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebPage",
"headline": "Initializers",
"description": "Library for building scalable node.js applications with ease",
"url": "http://vladaspasic.github.io//node-registry/docs/initializers.html"}</script>
<!-- End Jekyll SEO tag -->


  
    <!-- Google analytics -->
<script>
(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='https://www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-57430955-1','auto');ga('send','pageview');
</script>

  
</head>


  <body>

    <header class="navbar navbar-default site-header" role="banner">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="/node-registry/">Node registry</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav navbar-right">
        <li class="active">
          <a class="page-link" href="/node-registry/docs">Docs</a>
        </li>
        <li class="">
          <a class="page-link" href="/node-registry/plugins">Plugins</a>
        </li>
        <li>
          <a class="page-link" href="/node-registry/api">API</a>
        </li>
        <li>
          <a class="page-link" href="https://github.com/vladaspasic/node-registry" target="_blank">Github</a>
        </li>
      </ul>
    </nav>
</header>


    <main class="page-content documentation container" aria-label="Content">
      <div class="row">
        <div class="col-xs-hidden col-sm-4 col-md-2">
          <ul class="nav doc-nav" data-spy="affix">
            <li>
              <a href="/node-registry/docs/getting-started">Getting started</a>
            </li>
            <li>
              <a href="/node-registry/docs/configuration">Configuration</a>
            </li>
            <li>
              <a href="/node-registry/docs/modules">Modules</a>
            </li>
            <li>
              <a href="/node-registry/docs/initializers">Initializers</a>
            </li>
            <li>
              <a href="/node-registry/docs/server">Server</a>
            </li>
          </ul>
        </div>
        <div class="col-xs-12 col-sm-8 col-md-10">
          <h3 id="initializers">Initializers</h3>

<p>Initializers are functions that are invoked before we start the server. This is usefull when you are trying to execute some asyncronous code before the server starts, like check if the database is running and if you can connect to it. There is no point in starting the server if our database is not there, we should instead notify that the database is unavailable and you should fix this problem first.</p>

<p>As initializers are tightly coupled to modules, you can add an <code class="highlighter-rouge">initializer.js</code> file in your module directory. <strong>Registry</strong> would pick it up and register it.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>- modules/
    - database/
        -index.js <span class="c">## Module logic</span>
        -initializer.js <span class="c">## Initializer for the module</span>
</code></pre>
</div>

<p>Your <code class="highlighter-rouge">initializer</code> file would something like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 'name' is not required, default value is the module name</span>
  <span class="c1">// If you export a function it would also work</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'database'</span><span class="p">,</span>
  <span class="nx">initializer</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">'database'</span><span class="p">)</span>

    <span class="nx">database</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">())</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Or if you register it via <code class="highlighter-rouge">Registry.registerInitializer</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">Registry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'node-registry'</span><span class="p">)</span>

<span class="nx">Registry</span><span class="p">.</span><span class="nx">registerInitializer</span><span class="p">({</span>
  <span class="c1">// here 'name' is required!</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'database'</span><span class="p">,</span>
  <span class="nx">initializer</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">'database'</span><span class="p">)</span>

    <span class="nx">database</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">())</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>

<p>Initializers will be executed before we start the server, and depending if the callback is not invoked with an error, the server will be started.</p>

<h4 id="ordering">Ordering</h4>

<p>We can also order our initializers by setting the <code class="highlighter-rouge">before</code> and <code class="highlighter-rouge">after</code> properties.</p>

<p>Lets imagine that you have an another <code class="highlighter-rouge">initializer</code> that would insert some default values in the database on each server start. In order to insert these values we must establish a database connection first. That is why we are going to run this <code class="highlighter-rouge">initializer</code> <strong>after</strong> the <code class="highlighter-rouge">database</code> one.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">Registry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'node-registry'</span><span class="p">)</span>

<span class="nx">Registry</span><span class="p">.</span><span class="nx">registerInitializer</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'inserter'</span><span class="p">,</span>
  <span class="na">after</span><span class="p">:</span> <span class="s1">'database'</span><span class="p">,</span>
  <span class="nx">initializer</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">'database'</span><span class="p">)</span>

    <span class="nx">database</span><span class="p">.</span><span class="nx">insert</span><span class="p">([...</span> <span class="nx">values</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">())</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>

<p>Or you can declare the <code class="highlighter-rouge">database</code> <code class="highlighter-rouge">initializer</code> to be run <strong>before</strong> the <code class="highlighter-rouge">inserter</code>.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">Registry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'node-registry'</span><span class="p">)</span>

<span class="nx">Registry</span><span class="p">.</span><span class="nx">registerInitializer</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'database'</span><span class="p">,</span>
  <span class="na">before</span><span class="p">:</span> <span class="s1">'inserter'</span><span class="p">,</span>
  <span class="nx">initializer</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">'database'</span><span class="p">)</span>

    <span class="nx">database</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">())</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>

<div class="row button-navigation">
  <div class="col-xs-6 text-left">
    
      <a class="btn btn-primary prev" href="/node-registry/docs/modules">
         <i class="fa fa-angle-left" aria-hidden="true"></i>
<span>Modules</span>
      </a>
    
  </div>
  <div class="col-xs-6 text-right">
    
      <a class="btn btn-primary next" href="/node-registry/docs/server">
        <span>Server</span> <i class="fa fa-angle-right" aria-hidden="true"></i>

      </a>
        
  </div>
</div>


        </div>
      </div>
    </main>

    <footer class="site-footer">
  <div class="container">
    <div class="col-sm-4">
      <!-- <ul class="nav nav-links">
        <li>
          <a href="/docs">Docs</a>
        </li>
        <li>
          <a href="/docs/quickstart">Quick start</a>
        </li>
      </ul> -->
    </div>
    <div class="col-sm-8">
      <ul class="nav icon-links">
        
          <li>
            <a href="mailto:vladimir.spasic.86@gmail.com">
               <i class="fa fa-envelope-o" aria-hidden="true"></i>

            </a>
          </li>
        
        
            <li>
              <a href="https://github.com/vladaspasic/node-registry">
                 <i class="fa fa-github" aria-hidden="true"></i>

              </a>
            </li>
            

            
            <li>
              <a href="https://twitter.com/VladaSpasic">
                 <i class="fa fa-twitter" aria-hidden="true"></i>

              </a>
            </li>
          
      </ul>
    </div>
    <div class="row">
      <div class="col-xs-12 text-center repo-link">
        <a href="https://icons8.com">Icon pack by Icons8</a><br/>
        <a href="https://github.com/vladaspasic/node-registry/blob/master/LICENSE">
          node-registry is free and open-source under the Apache v2 License.
        </a>
      </div>
    </div>
  </div>
</footer>

<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/yaml.min.js"></script>  
<script src="/node-registry/assets/javascripts/bootstrap.min.js"></script>
<script src="/node-registry/js/main.js"></script>


  </body>

</html>
